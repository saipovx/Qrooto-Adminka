{"ast":null,"code":"import axios from'axios';import{createContext,useContext,useEffect}from'react';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext();export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var apiUrl=process.env.REACT_APP_API_URL;var refreshToken=function refreshToken(){var refresh_token=localStorage.getItem('refresh_token');if(refresh_token){axios.post(\"\".concat(apiUrl,\"/api/auth/refresh\"),{},{headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(refresh_token)}}).then(function(res){if(res.status===200){var access_token=res.data.access_token;localStorage.setItem('access_token',access_token);}}).catch(function(error){});}};var setupTokenRefresh=function setupTokenRefresh(){var access_token=localStorage.getItem('access_token');if(access_token){var expirationTime=Number(localStorage.getItem('expiration_time'));// Парсим время истечения из localStorage\nvar currentTime=Date.now();if(expirationTime>currentTime){var timeUntilRefresh=expirationTime-currentTime;setTimeout(function(){refreshToken();setupTokenRefresh();// Запустите обновление таймера\n},timeUntilRefresh);}}};// Вызовите функцию setupTokenRefresh при монтировании компонента\nuseEffect(function(){setupTokenRefresh();},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{refreshToken:refreshToken},children:children});};export var useAuth=function useAuth(){return useContext(AuthContext);};","map":{"version":3,"names":["axios","createContext","useContext","useEffect","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","apiUrl","process","env","REACT_APP_API_URL","refreshToken","refresh_token","localStorage","getItem","post","concat","headers","then","res","status","access_token","data","setItem","catch","error","setupTokenRefresh","expirationTime","Number","currentTime","Date","now","timeUntilRefresh","setTimeout","Provider","value","useAuth"],"sources":["/home/t1/Рабочий стол/kuplatform/admin-stage/src/AuthContext.js"],"sourcesContent":["import axios from 'axios';\nimport { createContext, useContext, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n\n  const apiUrl = process.env.REACT_APP_API_URL;\n\n  const refreshToken = () => {\n\n    const refresh_token = localStorage.getItem('refresh_token');\n  \n    if (refresh_token) {\n\n      axios\n\n        .post(`${apiUrl}/api/auth/refresh`, {\n\n        },\n        \n        {\n\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${refresh_token}` \n        }\n\n        }\n          \n          \n          )\n\n        \n\n        .then((res) => {\n\n          if (res.status === 200) {\n\n            const { access_token } = res.data;\n\n            localStorage.setItem('access_token', access_token);\n\n          }\n\n        })\n\n        .catch((error) => {\n\n        });\n    }\n  };\n\n  const setupTokenRefresh = () => {\n    const access_token = localStorage.getItem('access_token');\n    if (access_token) {\n      const expirationTime = Number(localStorage.getItem('expiration_time')); // Парсим время истечения из localStorage\n      const currentTime = Date.now();\n\n      if (expirationTime > currentTime) {\n        const timeUntilRefresh = expirationTime - currentTime;\n        setTimeout(() => {\n          refreshToken();\n          setupTokenRefresh(); // Запустите обновление таймера\n        }, timeUntilRefresh);\n      }\n    }\n  };\n\n  // Вызовите функцию setupTokenRefresh при монтировании компонента\n  useEffect(() => {\n    setupTokenRefresh();\n  }, []);\n\n\n  return (\n    <AuthContext.Provider value={{ refreshToken }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,aAAa,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC5D,OAASC,WAAW,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE/C,MAAO,IAAM,CAAAC,WAAW,cAAGN,aAAa,EAAE,CAE1C,MAAO,IAAM,CAAAO,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAAC,IAAA,CAAqB,IAAf,CAAAC,QAAQ,CAAAD,IAAA,CAARC,QAAQ,CAErC,GAAM,CAAAC,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAE5C,GAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAA,CAAS,CAEzB,GAAM,CAAAC,aAAa,CAAGC,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC,CAE3D,GAAIF,aAAa,CAAE,CAEjBhB,KAAK,CAEFmB,IAAI,IAAAC,MAAA,CAAIT,MAAM,sBAAqB,CAEpC,CAAC,CAED,CAEEU,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAAD,MAAA,CAAYJ,aAAa,CAC5C,CAEA,CAAC,CAGE,CAIFM,IAAI,CAAC,SAACC,GAAG,CAAK,CAEb,GAAIA,GAAG,CAACC,MAAM,GAAK,GAAG,CAAE,CAEtB,GAAQ,CAAAC,YAAY,CAAKF,GAAG,CAACG,IAAI,CAAzBD,YAAY,CAEpBR,YAAY,CAACU,OAAO,CAAC,cAAc,CAAEF,YAAY,CAAC,CAEpD,CAEF,CAAC,CAAC,CAEDG,KAAK,CAAC,SAACC,KAAK,CAAK,CAElB,CAAC,CAAC,CACN,CACF,CAAC,CAED,GAAM,CAAAC,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAA,CAAS,CAC9B,GAAM,CAAAL,YAAY,CAAGR,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CACzD,GAAIO,YAAY,CAAE,CAChB,GAAM,CAAAM,cAAc,CAAGC,MAAM,CAACf,YAAY,CAACC,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAE;AACxE,GAAM,CAAAe,WAAW,CAAGC,IAAI,CAACC,GAAG,EAAE,CAE9B,GAAIJ,cAAc,CAAGE,WAAW,CAAE,CAChC,GAAM,CAAAG,gBAAgB,CAAGL,cAAc,CAAGE,WAAW,CACrDI,UAAU,CAAC,UAAM,CACftB,YAAY,EAAE,CACde,iBAAiB,EAAE,CAAE;AACvB,CAAC,CAAEM,gBAAgB,CAAC,CACtB,CACF,CACF,CAAC,CAED;AACAjC,SAAS,CAAC,UAAM,CACd2B,iBAAiB,EAAE,CACrB,CAAC,CAAE,EAAE,CAAC,CAGN,mBACExB,IAAA,CAACC,WAAW,CAAC+B,QAAQ,EAACC,KAAK,CAAE,CAAExB,YAAY,CAAZA,YAAa,CAAE,CAAAL,QAAA,CAC3CA,QAAQ,EACY,CAE3B,CAAC,CAED,MAAO,IAAM,CAAA8B,OAAO,CAAG,QAAV,CAAAA,OAAOA,CAAA,CAAS,CAC3B,MAAO,CAAAtC,UAAU,CAACK,WAAW,CAAC,CAChC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}