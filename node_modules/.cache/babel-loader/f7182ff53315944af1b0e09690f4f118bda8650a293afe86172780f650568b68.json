{"ast":null,"code":"import axios from'axios';import{createContext,useContext,useEffect}from'react';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext();export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var apiUrl=process.env.REACT_APP_API_URL;var refresh_token=localStorage.getItem('refresh_token');var refreshToken=function refreshToken(){var config={method:'get',maxBodyLength:Infinity,url:\"\".concat(apiUrl,\"/api/auth/refresh\"),headers:{'Authorization':\"Bearer \".concat(refresh_token)}};axios.request(config).then(function(response){if(response.status===200){var access_token=response.data.access_token;localStorage.setItem('access_token',access_token);}}).catch(function(error){});};var setupTokenRefresh=function setupTokenRefresh(){var access_token=localStorage.getItem('access_token');if(access_token){var expirationTime=Number(localStorage.getItem('expiration_time'));var currentTime=Date.now();if(expirationTime>currentTime){var timeUntilRefresh=expirationTime-currentTime;setTimeout(function(){refreshToken();setupTokenRefresh();},timeUntilRefresh);}}};useEffect(function(){setupTokenRefresh();},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{refreshToken:refreshToken},children:children});};export var useAuth=function useAuth(){return useContext(AuthContext);};","map":{"version":3,"names":["axios","createContext","useContext","useEffect","useNavigate","jsx","_jsx","AuthContext","AuthProvider","_ref","children","apiUrl","process","env","REACT_APP_API_URL","refresh_token","localStorage","getItem","refreshToken","config","method","maxBodyLength","Infinity","url","concat","headers","request","then","response","status","access_token","data","setItem","catch","error","setupTokenRefresh","expirationTime","Number","currentTime","Date","now","timeUntilRefresh","setTimeout","Provider","value","useAuth"],"sources":["/home/t1/Рабочий стол/kuplatform/admin-stage/src/AuthContext.js"],"sourcesContent":["import axios from 'axios';\nimport { createContext, useContext, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nexport const AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n\n  const apiUrl = process.env.REACT_APP_API_URL;\n  \n  const refresh_token = localStorage.getItem('refresh_token');\n  \n  const refreshToken = () => {    \n\n    let config = {\n      method: 'get',\n      maxBodyLength: Infinity,\n      url: `${apiUrl}/api/auth/refresh`,\n      headers: { \n        'Authorization': `Bearer ${refresh_token}`\n      }\n    };\n    \n    axios.request(config)\n\n    .then((response) => {\n\n          if (response.status === 200) {\n\n            const { access_token } = response.data;\n\n            localStorage.setItem('access_token', access_token);\n\n          }\n\n    })\n\n    .catch((error) => {\n\n    });\n\n  };\n\n  const setupTokenRefresh = () => {\n\n    const access_token = localStorage.getItem('access_token');\n\n    if (access_token) {\n\n      const expirationTime = Number(localStorage.getItem('expiration_time')); \n\n      const currentTime = Date.now();\n\n      if (expirationTime > currentTime) {\n        const timeUntilRefresh = expirationTime - currentTime;\n        setTimeout(() => {\n          refreshToken();\n          setupTokenRefresh(); \n        }, timeUntilRefresh);\n      }\n    }\n  };\n\n\n  useEffect(() => {\n    setupTokenRefresh();\n  }, []);\n\n\n  return (\n    <AuthContext.Provider value={{ refreshToken }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,aAAa,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC5D,OAASC,WAAW,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE/C,MAAO,IAAM,CAAAC,WAAW,cAAGN,aAAa,EAAE,CAE1C,MAAO,IAAM,CAAAO,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAAC,IAAA,CAAqB,IAAf,CAAAC,QAAQ,CAAAD,IAAA,CAARC,QAAQ,CAErC,GAAM,CAAAC,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,CAE5C,GAAM,CAAAC,aAAa,CAAGC,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC,CAE3D,GAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAA,CAAS,CAEzB,GAAI,CAAAC,MAAM,CAAG,CACXC,MAAM,CAAE,KAAK,CACbC,aAAa,CAAEC,QAAQ,CACvBC,GAAG,IAAAC,MAAA,CAAKb,MAAM,qBAAmB,CACjCc,OAAO,CAAE,CACP,eAAe,WAAAD,MAAA,CAAYT,aAAa,CAC1C,CACF,CAAC,CAEDf,KAAK,CAAC0B,OAAO,CAACP,MAAM,CAAC,CAEpBQ,IAAI,CAAC,SAACC,QAAQ,CAAK,CAEd,GAAIA,QAAQ,CAACC,MAAM,GAAK,GAAG,CAAE,CAE3B,GAAQ,CAAAC,YAAY,CAAKF,QAAQ,CAACG,IAAI,CAA9BD,YAAY,CAEpBd,YAAY,CAACgB,OAAO,CAAC,cAAc,CAAEF,YAAY,CAAC,CAEpD,CAEN,CAAC,CAAC,CAEDG,KAAK,CAAC,SAACC,KAAK,CAAK,CAElB,CAAC,CAAC,CAEJ,CAAC,CAED,GAAM,CAAAC,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAA,CAAS,CAE9B,GAAM,CAAAL,YAAY,CAAGd,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAEzD,GAAIa,YAAY,CAAE,CAEhB,GAAM,CAAAM,cAAc,CAAGC,MAAM,CAACrB,YAAY,CAACC,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAEtE,GAAM,CAAAqB,WAAW,CAAGC,IAAI,CAACC,GAAG,EAAE,CAE9B,GAAIJ,cAAc,CAAGE,WAAW,CAAE,CAChC,GAAM,CAAAG,gBAAgB,CAAGL,cAAc,CAAGE,WAAW,CACrDI,UAAU,CAAC,UAAM,CACfxB,YAAY,EAAE,CACdiB,iBAAiB,EAAE,CACrB,CAAC,CAAEM,gBAAgB,CAAC,CACtB,CACF,CACF,CAAC,CAGDtC,SAAS,CAAC,UAAM,CACdgC,iBAAiB,EAAE,CACrB,CAAC,CAAE,EAAE,CAAC,CAGN,mBACE7B,IAAA,CAACC,WAAW,CAACoC,QAAQ,EAACC,KAAK,CAAE,CAAE1B,YAAY,CAAZA,YAAa,CAAE,CAAAR,QAAA,CAC3CA,QAAQ,EACY,CAE3B,CAAC,CAED,MAAO,IAAM,CAAAmC,OAAO,CAAG,QAAV,CAAAA,OAAOA,CAAA,CAAS,CAC3B,MAAO,CAAA3C,UAAU,CAACK,WAAW,CAAC,CAChC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}